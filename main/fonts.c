#include "fonts.h"
#include "display.h"
#include <string.h>


// Fuente MEDIUM

static const uint8_t font_medium_data[] = {
    0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00,
    0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00,
    // 0
    0x07,0x80, 0x1F,0xE0, 0x38,0x70, 0x30,0x30, 0x60,0x18, 0x60,0x18,
    0x60,0x18, 0x60,0x18, 0x30,0x30, 0x38,0x70, 0x1F,0xE0, 0x07,0x80,
    // 1
    0x03,0x00, 0x07,0x00, 0x1F,0x00, 0x03,0x00, 0x03,0x00, 0x03,0x00,
    0x03,0x00, 0x03,0x00, 0x03,0x00, 0x03,0x00, 0x1F,0xE0, 0x1F,0xE0,
    // 2
    0x0F,0xC0, 0x3F,0xF0, 0x70,0x30, 0x00,0x30, 0x00,0x70, 0x01,0xE0,
    0x07,0x80, 0x1E,0x00, 0x38,0x00, 0x30,0x00, 0x7F,0xF0, 0x7F,0xF0,
    // 3
    0x1F,0xC0, 0x3F,0xE0, 0x70,0x70, 0x00,0x30, 0x01,0xE0, 0x01,0xE0,
    0x00,0x70, 0x00,0x30, 0x60,0x30, 0x70,0x70, 0x3F,0xE0, 0x1F,0xC0,
    // 4
    0x01,0xC0, 0x03,0xC0, 0x07,0xC0, 0x0D,0xC0, 0x19,0xC0, 0x31,0xC0,
    0x61,0xC0, 0xFF,0xF0, 0xFF,0xF0, 0x01,0xC0, 0x01,0xC0, 0x01,0xC0,
    // 5
    0x7F,0xE0, 0x7F,0xE0, 0x60,0x00, 0x7F,0xC0, 0x7F,0xE0, 0x00,0x70,
    0x00,0x30, 0x00,0x30, 0x60,0x70, 0x70,0xE0, 0x3F,0xC0, 0x1F,0x80,
    // 6
    0x07,0xE0, 0x1F,0xE0, 0x38,0x00, 0x30,0x00, 0x6F,0xC0, 0x7F,0xE0,
    0x70,0x70, 0x60,0x30, 0x60,0x30, 0x30,0x70, 0x3F,0xE0, 0x0F,0xC0,
    // 7
    0x7F,0xF0, 0x7F,0xF0, 0x00,0x60, 0x00,0xC0, 0x01,0x80, 0x03,0x00,
    0x06,0x00, 0x0C,0x00, 0x0C,0x00, 0x0C,0x00, 0x0C,0x00, 0x0C,0x00,
    // 8
    0x0F,0xC0, 0x3F,0xE0, 0x30,0x70, 0x30,0x30, 0x1F,0xE0, 0x1F,0xE0,
    0x30,0x30, 0x60,0x18, 0x60,0x18, 0x70,0x38, 0x3F,0xF0, 0x1F,0xE0,
    // 9
    0x1F,0x80, 0x3F,0xE0, 0x70,0x60, 0x60,0x30, 0x60,0x30, 0x70,0x70,
    0x3F,0xF0, 0x1F,0xB0, 0x00,0x60, 0x00,0xE0, 0x3F,0xC0, 0x3F,0x00,
    // A
    0x03,0x00, 0x07,0x80, 0x0C,0xC0, 0x18,0x60, 0x18,0x60, 0x3F,0xF0,
    0x3F,0xF0, 0x30,0x30, 0x30,0x30, 0x30,0x30, 0x30,0x30, 0x30,0x30,
    // C
    0x07,0xE0, 0x1F,0xF0, 0x38,0x10, 0x30,0x00, 0x60,0x00, 0x60,0x00,
    0x60,0x00, 0x60,0x00, 0x30,0x00, 0x38,0x10, 0x1F,0xF0, 0x07,0xE0,
    // D
    0x7F,0xC0, 0x7F,0xF0, 0x60,0x30, 0x60,0x18, 0x60,0x18, 0x60,0x18,
    0x60,0x18, 0x60,0x18, 0x60,0x30, 0x7F,0xF0, 0x7F,0xC0, 0x7F,0x00,
    // E
    0x7F,0xF0, 0x7F,0xF0, 0x60,0x00, 0x60,0x00, 0x7F,0xE0, 0x7F,0xE0,
    0x60,0x00, 0x60,0x00, 0x60,0x00, 0x60,0x00, 0x7F,0xF0, 0x7F,0xF0,
    // F
    0x7F,0xF0, 0x7F,0xF0, 0x60,0x00, 0x60,0x00, 0x7F,0xE0, 0x7F,0xE0,
    0x60,0x00, 0x60,0x00, 0x60,0x00, 0x60,0x00, 0x60,0x00, 0x60,0x00,
    // I
    0x7F,0xF0, 0x7F,0xF0, 0x06,0x00, 0x06,0x00, 0x06,0x00, 0x06,0x00,
    0x06,0x00, 0x06,0x00, 0x06,0x00, 0x06,0x00, 0x7F,0xF0, 0x7F,0xF0,
    // O
    0x07,0x80, 0x1F,0xE0, 0x38,0x70, 0x30,0x30, 0x60,0x18, 0x60,0x18,
    0x60,0x18, 0x60,0x18, 0x30,0x30, 0x38,0x70, 0x1F,0xE0, 0x07,0x80,
    // P
    0x7F,0xC0, 0x7F,0xF0, 0x60,0x30, 0x60,0x18, 0x60,0x18, 0x60,0x30,
    0x7F,0xF0, 0x7F,0xC0, 0x60,0x00, 0x60,0x00, 0x60,0x00, 0x60,0x00,
    // S
    0x1F,0xC0, 0x3F,0xE0, 0x70,0x70, 0x60,0x00, 0x7C,0x00, 0x3F,0xC0,
    0x07,0xE0, 0x00,0x70, 0x00,0x30, 0x60,0x70, 0x7F,0xE0, 0x3F,0xC0,
    // Y
    0x60,0x30, 0x30,0x60, 0x18,0xC0, 0x0D,0x80, 0x07,0x00, 0x06,0x00,
    0x06,0x00, 0x06,0x00, 0x06,0x00, 0x06,0x00, 0x06,0x00, 0x06,0x00,
    
    // SÃ­mbolo % 
    0x00,0x00, 0x60,0x60, 0x30,0xC0, 0x19,0x80, 0x0F,0x00, 0x06,0x00,
    0x03,0x00, 0x07,0x80, 0x0C,0xC0, 0x18,0x60, 0x30,0x30, 0x00,0x00,
    // B
    0x7F,0x80, 0xFF,0xC0, 0x60,0xC0, 0x60,0xC0, 0x7F,0x80, 0xFF,0xC0,
    0x60,0xC0, 0x60,0xC0, 0x60,0xC0, 0x60,0xC0, 0xFF,0xC0, 0x7F,0x80,
    // H
    0x60,0xC0, 0x60,0xC0, 0x60,0xC0, 0x60,0xC0, 0x7F,0xC0, 0xFF,0xC0,
    0x60,0xC0, 0x60,0xC0, 0x60,0xC0, 0x60,0xC0, 0x60,0xC0, 0x60,0xC0,
    // K
    0x60,0x60, 0x60,0xC0, 0x61,0x80, 0x63,0x00, 0x66,0x00, 0x7E,0x00,
    0x6F,0x00, 0x67,0x80, 0x63,0xC0, 0x61,0xE0, 0x60,0xF0, 0x60,0x78,
    // L
    0x60,0x00, 0x60,0x00, 0x60,0x00, 0x60,0x00, 0x60,0x00, 0x60,0x00,
    0x60,0x00, 0x60,0x00, 0x60,0x00, 0x60,0x00, 0x7F,0xF0, 0x7F,0xF0,
    // M
    0xC0,0x60, 0xE0,0xE0, 0xF1,0xE0, 0xFB,0x60, 0xDF,0x60, 0xCF,0xE0,
    0xC7,0xE0, 0xC3,0xE0, 0xC1,0xE0, 0xC0,0xE0, 0xC0,0x60, 0xC0,0x60,
    // N
    0x60,0xC0, 0x70,0xC0, 0x78,0xC0, 0x7C,0xC0, 0x6E,0xC0, 0x67,0xC0,
    0x63,0xC0, 0x61,0xC0, 0x60,0xE0, 0x60,0xE0, 0x60,0x70, 0x60,0x30,
    // R
    0x7F,0x80, 0xFF,0xC0, 0x60,0xC0, 0x60,0xC0, 0x7F,0x80, 0x7F,0x00,
    0x63,0x80, 0x61,0xC0, 0x60,0xE0, 0x60,0x70, 0x60,0x38, 0x60,0x1C,
    // T
    0x7F,0xF0, 0x7F,0xF0, 0x01,0x80, 0x01,0x80, 0x01,0x80, 0x01,0x80,
    0x01,0x80, 0x01,0x80, 0x01,0x80, 0x01,0x80, 0x01,0x80, 0x01,0x80,
    // U
    0x60,0xC0, 0x60,0xC0, 0x60,0xC0, 0x60,0xC0, 0x60,0xC0, 0x60,0xC0,
    0x60,0xC0, 0x60,0xC0, 0x60,0xC0, 0x70,0xC0, 0x3F,0x80, 0x1F,0x00,
    // V
    0xC0,0x60, 0xC0,0x60, 0x60,0x60, 0x60,0x60, 0x30,0xC0, 0x30,0xC0,
    0x19,0x80, 0x19,0x80, 0x0F,0x00, 0x0F,0x00, 0x06,0x00, 0x06,0x00,
    // :
    0x00,0x00, 0x00,0x00, 0x00,0x00, 0x03,0x00, 0x07,0x80, 0x07,0x80,
    0x03,0x00, 0x00,0x00, 0x03,0x00, 0x07,0x80, 0x07,0x80, 0x03,0x00,
    // .
    0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00,
    0x00,0x00, 0x00,0x00, 0x00,0x00, 0x03,0x00, 0x07,0x80, 0x07,0x80,
    // /
    0x00,0x30, 0x00,0x60, 0x00,0xC0, 0x01,0x80, 0x03,0x00, 0x06,0x00,
    0x0C,0x00, 0x18,0x00, 0x30,0x00, 0x60,0x00, 0xC0,0x00, 0x80,0x00

};


static const uint8_t font_large_data[] = {
    // (espacio)
    0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00,
    0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00,
    0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00,
    0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00,
    // A
    0x0F,0xC0, 0x1F,0xE0, 0x38,0x70, 0x30,0x30,
    0x70,0x38, 0x60,0x18, 0x60,0x18, 0xFF,0xF8,
    0xFF,0xF8, 0xC0,0x0C, 0xC0,0x0C, 0xC0,0x0C,
    0xC0,0x0C, 0xC0,0x0C, 0xC0,0x0C, 0xC0,0x0C,
    // F
    0xFF,0xFE, 0xFF,0xFE, 0xC0,0x00, 0xC0,0x00,
    0xFF,0xC0, 0xFF,0xC0, 0xC0,0x00, 0xC0,0x00,
    0xC0,0x00, 0xC0,0x00, 0xC0,0x00, 0xC0,0x00,
    0xC0,0x00, 0xC0,0x00, 0xC0,0x00, 0xC0,0x00,
    // I
    0xFF,0xFF, 0xFF,0xFF, 0x18,0x18, 0x18,0x18,
    0x18,0x18, 0x18,0x18, 0x18,0x18, 0x18,0x18,
    0x18,0x18, 0x18,0x18, 0x18,0x18, 0x18,0x18,
    0xFF,0xFF, 0xFF,0xFF, 0x00,0x00, 0x00,0x00,
    // I
    0xFF,0xFF, 0xFF,0xFF, 0x18,0x18, 0x18,0x18,
    0x18,0x18, 0x18,0x18, 0x18,0x18, 0x18,0x18,
    0x18,0x18, 0x18,0x18, 0x18,0x18, 0x18,0x18,
    0xFF,0xFF, 0xFF,0xFF, 0x00,0x00, 0x00,0x00,
    // S
    0x3F,0xF0, 0x7F,0xF8, 0xC0,0x00, 0xC0,0x00,
    0xFF,0xE0, 0x7F,0xF0, 0x00,0x38, 0x00,0x18,
    0x00,0x18, 0x00,0x18, 0xC0,0x18, 0xFF,0xF8,
    0x7F,0xF0, 0x00,0x00, 0x00,0x00, 0x00,0x00,
    // O
    0x3F,0xF0, 0x7F,0xF8, 0xE0,0x1C, 0xC0,0x0C,
    0xC0,0x0C, 0xC0,0x0C, 0xC0,0x0C, 0xC0,0x0C,
    0xC0,0x0C, 0xC0,0x0C, 0xC0,0x0C, 0xE0,0x1C,
    0x7F,0xF8, 0x3F,0xF0, 0x00,0x00, 0x00,0x00,
    // C
    0x3F,0xF0, 0x7F,0xF8, 0xE0,0x00, 0xC0,0x00,
    0xC0,0x00, 0xC0,0x00, 0xC0,0x00, 0xC0,0x00,
    0xC0,0x00, 0xC0,0x00, 0xE0,0x00, 0x7F,0xF8,
    0x3F,0xF0, 0x00,0x00, 0x00,0x00, 0x00,0x00,
    // Y
    0xC0,0x0C, 0x60,0x18, 0x30,0x30, 0x18,0x60,
    0x0C,0xC0, 0x07,0x80, 0x07,0x80, 0x07,0x80,
    0x07,0x80, 0x07,0x80, 0x07,0x80, 0x07,0x80,
    0x07,0x80, 0x07,0x80, 0x00,0x00, 0x00,0x00,
    // P
    0xFF,0xF0, 0xFF,0xF8, 0xC0,0x18, 0xC0,0x18,
    0xC0,0x18, 0xFF,0xF8, 0xFF,0xF0, 0xC0,0x00,
    0xC0,0x00, 0xC0,0x00, 0xC0,0x00, 0xC0,0x00,
    0xC0,0x00, 0xC0,0x00, 0x00,0x00, 0x00,0x00,
    // D
    0xFF,0xFC, 0xFF,0xFE, 0xC0,0x06, 0xC0,0x06, 
    0xC0,0x06, 0xC0,0x06, 0xC0,0x06, 0xC0,0x06,
    0xC0,0x06, 0xC0,0x06, 0xFF,0xFE, 0xFF,0xFC,
    // E
    0xFF,0xFF, 0xFF,0xFF, 0xC0,0x00, 0xFF,0xF0, 
    0xFF,0xF0, 0xC0,0x00, 0xC0,0x00, 0xC0,0x00, 
    0xFF,0xFF, 0xFF,0xFF, 0xFF,0xFF, 0xFF,0xFF,
    // B
    0xFF,0xF0, 0xFF,0xF8, 0xC0,0x18, 0xC0,0x18,
    0xC0,0x18, 0xFF,0xF0, 0xFF,0xF8, 0xC0,0x18,
    0xC0,0x18, 0xC0,0x18, 0xFF,0xF8, 0xFF,0xF0,
    // H
    0xC0,0x18, 0xC0,0x18, 0xC0,0x18, 0xC0,0x18,
    0xC0,0x18, 0xFF,0xF8, 0xFF,0xF8, 0xC0,0x18,
    0xC0,0x18, 0xC0,0x18, 0xC0,0x18, 0xC0,0x18,
    // K
    0xC0,0x30, 0xC0,0x60, 0xC0,0xC0, 0xC1,0x80,
    0xC3,0x00, 0xC6,0x00, 0xCF,0x00, 0xD9,0x80,
    0xF0,0xC0, 0xE0,0x60, 0xC0,0x30, 0xC0,0x18,
    // L
    0xC0,0x00, 0xC0,0x00, 0xC0,0x00, 0xC0,0x00,
    0xC0,0x00, 0xC0,0x00, 0xC0,0x00, 0xC0,0x00,
    0xC0,0x00, 0xC0,0x00, 0xFF,0xF0, 0xFF,0xF0,
    // M
    0xC0,0x18, 0xE0,0x38, 0xF0,0x78, 0xD8,0xD8,
    0xCC,0x98, 0xC6,0x18, 0xC3,0x18, 0xC1,0x98,
    0xC0,0xD8, 0xC0,0x78, 0xC0,0x38, 0xC0,0x18,
    // N
    0xC0,0x18, 0xE0,0x18, 0xF0,0x18, 0xD8,0x18,
    0xCC,0x18, 0xC6,0x18, 0xC3,0x18, 0xC1,0x98,
    0xC0,0xD8, 0xC0,0x78, 0xC0,0x38, 0xC0,0x18,
    // R
    0xFF,0xE0, 0xFF,0xF0, 0xC0,0x30, 0xC0,0x30,
    0xFF,0xE0, 0xFF,0xC0, 0xC1,0x80, 0xC3,0x00,
    0xC6,0x00, 0xCC,0x00, 0xC0,0x00, 0xC0,0x00,
    // T
    0xFF,0xFC, 0xFF,0xFC, 0x03,0x00, 0x03,0x00,
    0x03,0x00, 0x03,0x00, 0x03,0x00, 0x03,0x00,
    0x03,0x00, 0x03,0x00, 0x03,0x00, 0x03,0x00,
    // U
    0xC0,0x18, 0xC0,0x18, 0xC0,0x18, 0xC0,0x18,
    0xC0,0x18, 0xC0,0x18, 0xC0,0x18, 0xC0,0x18,
    0xC0,0x18, 0xE0,0x38, 0x7F,0xF0, 0x3F,0xE0,
    // V
    0xC0,0x18, 0xC0,0x18, 0x60,0x30, 0x60,0x30,
    0x30,0x60, 0x30,0x60, 0x18,0xC0, 0x18,0xC0,
    0x0D,0x80, 0x0F,0x80, 0x07,0x00, 0x06,0x00,
    // :
    0x00,0x00, 0x00,0x00, 0x18,0x00, 0x3C,0x00,
    0x3C,0x00, 0x18,0x00, 0x00,0x00, 0x00,0x00,
    0x18,0x00, 0x3C,0x00, 0x3C,0x00, 0x18,0x00,
    // .
    0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00,
    0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00,
    0x18,0x00, 0x3C,0x00, 0x3C,0x00, 0x18,0x00,
    // /
    0x00,0x18, 0x00,0x30, 0x00,0x60, 0x00,0xC0,
    0x01,0x80, 0x03,0x00, 0x06,0x00, 0x0C,0x00,
    0x18,0x00, 0x30,0x00, 0x60,0x00, 0xC0,0x00
};


// Estructura de fuente
typedef struct {
    uint8_t width;
    uint8_t height;
    const uint8_t *data;
    uint8_t first_char;
    uint8_t char_count;
} font_t;

// fuentes disponibles
static const font_t fonts[] = {
    [FONT_MEDIUM] = {
        .width = 12,
        .height = 16,
        .data = font_medium_data,
        .first_char = 32,
        .char_count = sizeof(font_medium_data) / (16 * 12 / 8)
    },
    [FONT_LARGE] = {
        .width = 16,
        .height = 24,
        .data = font_large_data,
        .first_char = 32,
        .char_count = sizeof(font_large_data) / (24 * 16 / 8)
    }
};

// funciones

void display_draw_text(const char *text, uint16_t x, uint16_t y, uint16_t color, font_size_t size) {
    const font_t *font = &fonts[size];
    uint16_t current_x = x;
    
    for (const char *c = text; *c; c++) {
        if (*c < font->first_char || *c >= (font->first_char + font->char_count)) {
            continue; 
        }
        
        uint32_t char_offset = (*c - font->first_char) * font->height * ((font->width + 7) / 8);
        const uint8_t *char_data = &font->data[char_offset];
        
        for (uint8_t row = 0; row < font->height; row++) {
            for (uint8_t col = 0; col < font->width; col++) {
                uint8_t byte_pos = col / 8;
                uint8_t bit_pos = 7 - (col % 8);
                
                if (char_data[row * ((font->width + 7) / 8) + byte_pos] & (1 << bit_pos)) {
                    display_draw_pixel(current_x + col, y + row, color);
                }
            }
        }
        current_x += font->width + 1;
    }
}

uint16_t get_text_width(const char *text, font_size_t size) {
    return strlen(text) * (fonts[size].width + 1);
}